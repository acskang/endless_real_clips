<!-- ê²€ìƒ‰ í¼ ì„¹ì…˜: ë””ë²„ê·¸ ë²„ì „ (ì…ë ¥ê°’ ì „ì†¡ ë¬¸ì œ í•´ê²°) -->
<section class="search-section mb-5">
    <form id="search-form" method="POST" action="{% url 'phrase:process_text' %}">
        {% csrf_token %}
        
        <!-- ğŸ” ë””ë²„ê·¸: í˜„ì¬ ê°’ í‘œì‹œ -->
        <div class="bg-info text-dark p-2 mb-3 rounded d-none" id="debug-info">
            <small>
                <strong>ë””ë²„ê·¸ ì •ë³´:</strong><br>
                ë°ìŠ¤í¬í†± ì…ë ¥: <span id="debug-desktop"></span><br>
                ëª¨ë°”ì¼ ì…ë ¥: <span id="debug-mobile"></span><br>
                í†µí•© í•„ë“œ: <span id="debug-unified"></span>
            </small>
        </div>
        
        <!-- ìˆ¨ê²¨ì§„ í†µí•© ì…ë ¥ í•„ë“œ (ì‹¤ì œ ì„œë²„ë¡œ ì „ì†¡) - ë””ë²„ê·¸ ê°œì„  -->
        <input type="hidden" id="unified-search-input" name="user_text" value="{{ message|default:'' }}">
        
        <!-- ë°ìŠ¤í¬í†±ìš© ê²€ìƒ‰ë°” (md ì´ìƒ) -->
        <div class="d-none d-md-block">
            <div class="input-group input-group-lg">
                <span class="input-group-text bg-dark border-secondary px-3">
                    <i class="fas fa-search text-primary"></i>
                </span>
                <input 
                    type="text" 
                    id="search-input-desktop"
                    class="form-control bg-dark border-secondary text-white"
                    placeholder="í•œê¸€ ë˜ëŠ” ì˜ì–´ êµ¬ë¬¸ì„ ì…ë ¥í•˜ì„¸ìš”... (ìµœëŒ€ 500ì)"
                    value="{{ message|default:'' }}"
                    autocomplete="off"
                    autofocus
                    maxlength="500"
                    aria-label="ê²€ìƒ‰ì–´ ì…ë ¥"
                />
                <button type="button" id="clear-search-desktop" class="btn btn-outline-secondary {% if not message %}d-none{% endif %}">
                    <i class="fas fa-times"></i>
                </button>
                <button 
                    type="submit" 
                    class="btn btn-primary px-4"
                    aria-label="ê²€ìƒ‰ ì‹¤í–‰"
                >
                    <i class="fas fa-search me-2"></i>ê²€ìƒ‰
                </button>
            </div>
        </div>
        
        <!-- ëª¨ë°”ì¼/íƒœë¸”ë¦¿ìš© ê²€ìƒ‰ë°” (sm ì´í•˜) -->
        <div class="d-md-none">
            <!-- ê²€ìƒ‰ ì…ë ¥ì°½ -->
            <div class="position-relative mb-2">
                <input 
                    type="text" 
                    id="search-input-mobile"
                    class="form-control form-control-lg bg-dark border-secondary text-white ps-5 pe-5"
                    placeholder="ê²€ìƒ‰ì–´ ì…ë ¥... (ìµœëŒ€ 500ì)"
                    value="{{ message|default:'' }}"
                    autocomplete="off"
                    maxlength="500"
                    aria-label="ê²€ìƒ‰ì–´ ì…ë ¥"
                    style="padding-right: 4rem !important;"
                />
                <!-- ì™¼ìª½ ë‹ë³´ê¸° ì•„ì´ì½˜ -->
                <div class="position-absolute top-50 start-0 translate-middle-y ps-3" style="pointer-events: none;">
                    <i class="fas fa-search text-primary"></i>
                </div>
                <!-- ì˜¤ë¥¸ìª½ ì§€ìš°ê¸° ë²„íŠ¼ -->
                <button 
                    type="button" 
                    id="clear-search-mobile" 
                    class="btn btn-link position-absolute top-50 end-0 translate-middle-y pe-3 text-secondary {% if not message %}d-none{% endif %}"
                    style="border: none; background: none; z-index: 10;"
                    aria-label="ê²€ìƒ‰ì–´ ì§€ìš°ê¸°"
                >
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <!-- ê²€ìƒ‰ ë²„íŠ¼ -->
            <div class="d-grid">
                <button 
                    type="submit" 
                    class="btn btn-primary btn-lg"
                    aria-label="ê²€ìƒ‰ ì‹¤í–‰"
                >
                    <i class="fas fa-search me-2"></i>ê²€ìƒ‰í•˜ê¸°
                </button>
            </div>
        </div>
        
        <!-- ğŸ”§ ë””ë²„ê·¸ ë²„íŠ¼ë“¤ -->
        <div class="mt-2 d-flex gap-2">
            <button type="button" id="toggle-debug" class="btn btn-outline-warning btn-sm">
                <i class="fas fa-bug"></i> ë””ë²„ê·¸ ëª¨ë“œ
            </button>
            <button type="button" id="manual-sync" class="btn btn-outline-info btn-sm">
                <i class="fas fa-sync"></i> ìˆ˜ë™ ë™ê¸°í™”
            </button>
        </div>
        
        <!-- ê²€ìƒ‰ ì˜µì…˜ (ê¸°ì¡´ê³¼ ë™ì¼) -->
        <div class="row mt-3 g-2">
            <div class="col-sm-6">
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="include-korean" checked>
                    <label class="form-check-label text-light small" for="include-korean">
                        <i class="fas fa-language me-1"></i>í•œê¸€ ë²ˆì—­ í¬í•¨ ê²€ìƒ‰
                    </label>
                </div>
            </div>
            <div class="col-sm-6">
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="exact-match">
                    <label class="form-check-label text-light small" for="exact-match">
                        <i class="fas fa-bullseye me-1"></i>ì •í™•í•œ ë¬¸êµ¬ë§Œ ê²€ìƒ‰
                    </label>
                </div>
            </div>
        </div>
    </form>
    
    <!-- ë¹ ë¥¸ ê²€ìƒ‰ ë²„íŠ¼ë“¤ (ëª¨ë°”ì¼ì—ì„œë§Œ í‘œì‹œ) - ë””ë²„ê·¸ ê°œì„  -->
    <div class="d-md-none mt-3">
        <div class="d-flex justify-content-between align-items-center mb-2">
            <small class="text-muted">
                <i class="fas fa-bolt me-1"></i>ë¹ ë¥¸ ê²€ìƒ‰ (ë””ë²„ê·¸ìš©)
            </small>
        </div>
        <div class="d-flex flex-wrap gap-2" id="quick-search-buttons">
            <button type="button" class="btn btn-outline-primary btn-sm quick-search-btn" data-query="hello">
                "hello"
            </button>
            <button type="button" class="btn btn-outline-primary btn-sm quick-search-btn" data-query="can you pick me up">
                "can you pick me up"
            </button>
            <button type="button" class="btn btn-outline-primary btn-sm quick-search-btn" data-query="just drop it">
                "just drop it"
            </button>
            <button type="button" class="btn btn-outline-primary btn-sm quick-search-btn" data-query="í…ŒìŠ¤íŠ¸">
                "í…ŒìŠ¤íŠ¸"
            </button>
        </div>
    </div>
</section>

<!-- ë””ë²„ê·¸ìš© JavaScript (ì„ì‹œ) -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    console.log('ğŸ” ê²€ìƒ‰ í¼ ë””ë²„ê·¸ ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ');
    
    // í•µì‹¬ ìš”ì†Œë“¤
    const desktopInput = document.getElementById('search-input-desktop');
    const mobileInput = document.getElementById('search-input-mobile');
    const unifiedInput = document.getElementById('unified-search-input');
    const searchForm = document.getElementById('search-form');
    const debugInfo = document.getElementById('debug-info');
    const toggleDebug = document.getElementById('toggle-debug');
    const manualSync = document.getElementById('manual-sync');
    
    // ë””ë²„ê·¸ ì •ë³´ ì—…ë°ì´íŠ¸
    function updateDebugInfo() {
        const desktopValue = desktopInput ? desktopInput.value : 'null';
        const mobileValue = mobileInput ? mobileInput.value : 'null';
        const unifiedValue = unifiedInput ? unifiedInput.value : 'null';
        
        document.getElementById('debug-desktop').textContent = `"${desktopValue}"`;
        document.getElementById('debug-mobile').textContent = `"${mobileValue}"`;
        document.getElementById('debug-unified').textContent = `"${unifiedValue}"`;
        
        console.log('ğŸ” DEBUG VALUES:', {
            desktop: desktopValue,
            mobile: mobileValue,
            unified: unifiedValue
        });
    }
    
    // ì…ë ¥ê°’ ë™ê¸°í™” í•¨ìˆ˜ (ê°œì„ ëœ ë²„ì „)
    function syncInputs() {
        console.log('ğŸ”„ ì…ë ¥ê°’ ë™ê¸°í™” ì‹œì‘');
        
        let currentValue = '';
        
        // í˜„ì¬ í™œì„± í™”ë©´ì— ë”°ë¼ ê°’ ê²°ì •
        if (window.innerWidth >= 768) {
            // ë°ìŠ¤í¬í†± ëª¨ë“œ
            currentValue = desktopInput ? desktopInput.value.trim() : '';
            console.log('ğŸ’» ë°ìŠ¤í¬í†± ëª¨ë“œ ì…ë ¥:', currentValue);
        } else {
            // ëª¨ë°”ì¼ ëª¨ë“œ
            currentValue = mobileInput ? mobileInput.value.trim() : '';
            console.log('ğŸ“± ëª¨ë°”ì¼ ëª¨ë“œ ì…ë ¥:', currentValue);
        }
        
        // í†µí•© í•„ë“œì— ê°’ ì„¤ì •
        if (unifiedInput) {
            unifiedInput.value = currentValue;
            console.log('ğŸ”— í†µí•© í•„ë“œ ì—…ë°ì´íŠ¸:', currentValue);
        }
        
        updateDebugInfo();
        return currentValue;
    }
    
    // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
    if (desktopInput) {
        desktopInput.addEventListener('input', function() {
            console.log('ğŸ’» ë°ìŠ¤í¬í†± ì…ë ¥ ë³€ê²½:', this.value);
            syncInputs();
        });
    }
    
    if (mobileInput) {
        mobileInput.addEventListener('input', function() {
            console.log('ğŸ“± ëª¨ë°”ì¼ ì…ë ¥ ë³€ê²½:', this.value);
            syncInputs();
        });
    }
    
    // í¼ ì œì¶œ ì‹œ ìµœì¢… ê²€ì¦
    if (searchForm) {
        searchForm.addEventListener('submit', function(e) {
            console.log('ğŸ“ í¼ ì œì¶œ ì‹œì‘');
            
            // ìµœì¢… ë™ê¸°í™”
            const finalValue = syncInputs();
            
            console.log('ğŸ“‹ ìµœì¢… ì œì¶œê°’:', finalValue);
            
            // ë¹ˆ ê°’ ì²´í¬
            if (!finalValue) {
                console.warn('âš ï¸ ë¹ˆ ê°’ ì œì¶œ ë°©ì§€');
                e.preventDefault();
                alert('ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return false;
            }
            
            console.log('âœ… í¼ ì œì¶œ ì§„í–‰');
        });
    }
    
    // ë””ë²„ê·¸ ëª¨ë“œ í† ê¸€
    if (toggleDebug) {
        toggleDebug.addEventListener('click', function() {
            debugInfo.classList.toggle('d-none');
            updateDebugInfo();
        });
    }
    
    // ìˆ˜ë™ ë™ê¸°í™”
    if (manualSync) {
        manualSync.addEventListener('click', function() {
            syncInputs();
            alert('ë™ê¸°í™” ì™„ë£Œ!');
        });
    }
    
    // ë¹ ë¥¸ ê²€ìƒ‰ ë²„íŠ¼
    document.querySelectorAll('.quick-search-btn').forEach(button => {
        button.addEventListener('click', function() {
            const query = this.dataset.query;
            console.log('âš¡ ë¹ ë¥¸ ê²€ìƒ‰:', query);
            
            // ëª¨ë“  ì…ë ¥ì°½ì— ê°’ ì„¤ì •
            if (desktopInput) desktopInput.value = query;
            if (mobileInput) mobileInput.value = query;
            if (unifiedInput) unifiedInput.value = query;
            
            updateDebugInfo();
            
            // í¼ ì œì¶œ
            searchForm.submit();
        });
    });
    
    // ì´ˆê¸° ë™ê¸°í™”
    setTimeout(() => {
        syncInputs();
        console.log('ğŸš€ ê²€ìƒ‰ í¼ ë””ë²„ê·¸ ì´ˆê¸°í™” ì™„ë£Œ');
    }, 100);
});
</script>

<!-- ê²€ìƒ‰ í¼ì— ì¶”ê°€í•  ë¡œë”© ì• ë‹ˆë©”ì´ì…˜ JavaScript -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    console.log('ğŸ” ë¡œë”© ì• ë‹ˆë©”ì´ì…˜ ì´ˆê¸°í™”');
    
    const searchForm = document.getElementById('search-form');
    const loadingOverlay = document.getElementById('search-loading-overlay');
    
    // ê²€ìƒ‰ ê¸°ë¡ (ê°„ë‹¨í•œ ë©”ëª¨ë¦¬ ì €ì¥)
    let searchHistory = JSON.parse(localStorage.getItem('searchHistory') || '[]');
    
    // ìƒˆë¡œìš´ ê²€ìƒ‰ì–´ì¸ì§€ í™•ì¸
    function isNewSearchQuery(query) {
        const trimmedQuery = query.trim().toLowerCase();
        const isNew = !searchHistory.includes(trimmedQuery);
        console.log(`ğŸ” ê²€ìƒ‰ì–´ "${trimmedQuery}" ìƒˆë¡œìš´ê°€ìš”?`, isNew);
        return isNew;
    }
    
    // ë¡œë”© ì• ë‹ˆë©”ì´ì…˜ í‘œì‹œ
    function showSearchLoadingAnimation() {
        console.log('ğŸ¬ ë¡œë”© ì• ë‹ˆë©”ì´ì…˜ ì‹œì‘');
        if (loadingOverlay) {
            loadingOverlay.classList.remove('d-none');
            document.body.style.overflow = 'hidden'; // ìŠ¤í¬ë¡¤ ë°©ì§€
            
            // ë‹¨ê³„ë³„ ì• ë‹ˆë©”ì´ì…˜
            startLoadingSteps();
        }
    }
    
    // ë¡œë”© ì• ë‹ˆë©”ì´ì…˜ ìˆ¨ê¹€
    function hideSearchLoadingAnimation() {
        console.log('ğŸ¬ ë¡œë”© ì• ë‹ˆë©”ì´ì…˜ ì¢…ë£Œ');
        if (loadingOverlay) {
            loadingOverlay.classList.add('d-none');
            document.body.style.overflow = ''; // ìŠ¤í¬ë¡¤ ë³µì›
        }
    }
    
    // 4ë‹¨ê³„ ë¡œë”© ì§„í–‰ ì• ë‹ˆë©”ì´ì…˜
    function startLoadingSteps() {
        const steps = [
            { id: 'step-search', title: 'ê²€ìƒ‰ ì¤‘...', message: 'ê²€ìƒ‰ì–´ë¥¼ ë¶„ì„í•˜ê³  ìˆìŠµë‹ˆë‹¤', delay: 0 },
            { id: 'step-fetch', title: 'ë°ì´í„° ê°€ì ¸ì˜¤ëŠ” ì¤‘...', message: 'ì™¸ë¶€ APIì—ì„œ ì˜í™” ì •ë³´ë¥¼ ìˆ˜ì§‘í•˜ê³  ìˆìŠµë‹ˆë‹¤', delay: 2000 },
            { id: 'step-process', title: 'ë°ì´í„° ì²˜ë¦¬ ì¤‘...', message: 'ì˜í™” ëŒ€ì‚¬ì™€ ë²ˆì—­ì„ ì²˜ë¦¬í•˜ê³  ìˆìŠµë‹ˆë‹¤', delay: 5000 },
            { id: 'step-save', title: 'ì €ì¥ ì¤‘...', message: 'ê²°ê³¼ë¥¼ ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥í•˜ê³  ìˆìŠµë‹ˆë‹¤', delay: 8000 }
        ];
        
        const loadingTitle = document.getElementById('loading-title');
        const loadingMessage = document.getElementById('loading-message');
        const progressBar = document.getElementById('search-progress');
        
        // í”„ë¡œê·¸ë ˆìŠ¤ ë°” ì• ë‹ˆë©”ì´ì…˜
        let progress = 0;
        const progressInterval = setInterval(() => {
            progress += Math.random() * 10;
            if (progress > 95) progress = 95; // 95%ì—ì„œ ë©ˆì¶¤ (ì™„ë£ŒëŠ” í˜ì´ì§€ ë¡œë“œ í›„)
            
            if (progressBar) {
                progressBar.style.width = progress + '%';
                progressBar.setAttribute('aria-valuenow', progress);
            }
        }, 300);
        
        // ë‹¨ê³„ë³„ ë©”ì‹œì§€ ë³€ê²½
        steps.forEach((step, index) => {
            setTimeout(() => {
                // ì´ì „ ë‹¨ê³„ë“¤ì„ ì™„ë£Œë¡œ í‘œì‹œ
                for (let i = 0; i < index; i++) {
                    const prevStep = document.getElementById(steps[i].id);
                    if (prevStep) {
                        prevStep.classList.remove('active');
                        prevStep.classList.add('completed');
                    }
                }
                
                // í˜„ì¬ ë‹¨ê³„ë¥¼ í™œì„±í™”
                const currentStep = document.getElementById(step.id);
                if (currentStep) {
                    currentStep.classList.add('active');
                }
                
                // ë©”ì‹œì§€ ì—…ë°ì´íŠ¸
                if (loadingTitle) loadingTitle.textContent = step.title;
                if (loadingMessage) loadingMessage.textContent = step.message;
                
                console.log(`ğŸ“ ë¡œë”© ë‹¨ê³„ ${index + 1}: ${step.title}`);
            }, step.delay);
        });
        
        // 15ì´ˆ í›„ ê°•ì œ ì¢…ë£Œ (ì•ˆì „ì¥ì¹˜)
        setTimeout(() => {
            console.log('â° ë¡œë”© íƒ€ì„ì•„ì›ƒ - ê°•ì œ ì¢…ë£Œ');
            clearInterval(progressInterval);
            hideSearchLoadingAnimation();
        }, 15000);
    }
    
    // ê²€ìƒ‰ ê¸°ë¡ì— ì¶”ê°€
    function addToSearchHistory(query) {
        const trimmedQuery = query.trim().toLowerCase();
        if (trimmedQuery && !searchHistory.includes(trimmedQuery)) {
            searchHistory.push(trimmedQuery);
            // ìµœëŒ€ 50ê°œê¹Œì§€ë§Œ ì €ì¥
            if (searchHistory.length > 50) {
                searchHistory = searchHistory.slice(-50);
            }
            localStorage.setItem('searchHistory', JSON.stringify(searchHistory));
            console.log('ğŸ“ ê²€ìƒ‰ ê¸°ë¡ì— ì¶”ê°€:', trimmedQuery);
        }
    }
    
    // í¼ ì œì¶œ ì´ë²¤íŠ¸
    if (searchForm) {
        searchForm.addEventListener('submit', function(e) {
            console.log('ğŸ“ ê²€ìƒ‰ í¼ ì œì¶œ ê°ì§€');
            
            // ì…ë ¥ê°’ ê°€ì ¸ì˜¤ê¸°
            let searchQuery = '';
            if (window.innerWidth >= 768) {
                // ë°ìŠ¤í¬í†±
                const desktopInput = document.getElementById('search-input-desktop');
                searchQuery = desktopInput ? desktopInput.value.trim() : '';
            } else {
                // ëª¨ë°”ì¼
                const mobileInput = document.getElementById('search-input-mobile');
                searchQuery = mobileInput ? mobileInput.value.trim() : '';
            }
            
            console.log('ğŸ” ê²€ìƒ‰ì–´:', searchQuery);
            
            // ë¹ˆ ê²€ìƒ‰ì–´ ì²´í¬
            if (!searchQuery) {
                console.warn('âš ï¸ ë¹ˆ ê²€ìƒ‰ì–´ - ë¡œë”© ì• ë‹ˆë©”ì´ì…˜ í‘œì‹œ ì•ˆí•¨');
                return;
            }
            
            // ìƒˆë¡œìš´ ê²€ìƒ‰ì–´ì¸ì§€ í™•ì¸
            if (isNewSearchQuery(searchQuery)) {
                console.log('ğŸ†• ìƒˆë¡œìš´ ê²€ìƒ‰ì–´ ê°ì§€ - ë¡œë”© ì• ë‹ˆë©”ì´ì…˜ ì‹œì‘');
                showSearchLoadingAnimation();
                
                // ê²€ìƒ‰ ê¸°ë¡ì— ì¶”ê°€ (ë¯¸ë¦¬ ì¶”ê°€)
                addToSearchHistory(searchQuery);
            } else {
                console.log('â™»ï¸ ê¸°ì¡´ ê²€ìƒ‰ì–´ - ë¡œë”© ì• ë‹ˆë©”ì´ì…˜ ê±´ë„ˆëœ€');
            }
        });
    }
    
    // í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ ì‹œ ë¡œë”© ìˆ¨ê¹€
    window.addEventListener('load', function() {
        setTimeout(() => {
            hideSearchLoadingAnimation();
            console.log('âœ… í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ - ë¡œë”© ì• ë‹ˆë©”ì´ì…˜ ì¢…ë£Œ');
        }, 500);
    });
    
    // Escape í‚¤ë¡œ ë¡œë”© ì·¨ì†Œ
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape' && loadingOverlay && !loadingOverlay.classList.contains('d-none')) {
            console.log('â‹ Escape í‚¤ë¡œ ë¡œë”© ì·¨ì†Œ');
            hideSearchLoadingAnimation();
        }
    });
    
    console.log('ğŸš€ ë¡œë”© ì• ë‹ˆë©”ì´ì…˜ ì‹œìŠ¤í…œ ì¤€ë¹„ ì™„ë£Œ');
});
</script>