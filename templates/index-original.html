{% load static %}
<!DOCTYPE html>
<html lang="ko" data-bs-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% if message %}{{ message }} - {% endif %}í”Œë ˆì´í”„ë ˆì´ì¦ˆ - ì˜í™” ëŒ€ì‚¬ ê²€ìƒ‰</title>
    <meta name="description" content="ì˜í™” ì† ì‹¤ì œ ëŒ€ì‚¬ë¥¼ ê²€ìƒ‰í•˜ê³  í´ë¦½ìœ¼ë¡œ ê°ìƒí•˜ì„¸ìš”. playphrase.meì™€ IMDB ë°ì´í„°ë¥¼ í™œìš©í•œ í•œê¸€ ë²ˆì—­ ì„œë¹„ìŠ¤">
    <meta name="keywords" content="ì˜í™”, ëŒ€ì‚¬, í´ë¦½, ë²ˆì—­, ê²€ìƒ‰, playphrase, ì˜ì–´í•™ìŠµ">
    
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <!-- ì‚¬ìš©ì ì •ì˜ CSS -->
    <link rel="stylesheet" href="{% static 'css/main.css' %}">
    
    <!-- CSRF í† í° ë©”íƒ€ íƒœê·¸ -->
    <meta name="csrf-token" content="{{ csrf_token }}">
    
    <!-- êµ¬ì¡°í™”ëœ ë°ì´í„° -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebApplication",
        "name": "í”Œë ˆì´í”„ë ˆì´ì¦ˆ",
        "description": "ì˜í™” ì† ì‹¤ì œ ëŒ€ì‚¬ë¥¼ ê²€ìƒ‰í•˜ê³  í´ë¦½ìœ¼ë¡œ ê°ìƒí•˜ì„¸ìš”",
        "url": "{{ request.build_absolute_uri }}",
        "applicationCategory": "Entertainment",
        "operatingSystem": "Web"
    }
    </script>
</head>
<body class="bg-dark text-white">
    <!-- ë„¤íŠ¸ì›Œí¬ ìƒíƒœ í‘œì‹œ -->
    <div id="network-status" class="alert alert-warning position-fixed top-0 start-50 translate-middle-x mt-3" style="display: none; z-index: 1060;">
        <i class="fas fa-wifi"></i> ì˜¤í”„ë¼ì¸ ìƒíƒœì…ë‹ˆë‹¤. ì¼ë¶€ ê¸°ëŠ¥ì´ ì œí•œë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
    </div>

    <!-- ë¡œë”© ì˜¤ë²„ë ˆì´ (ìƒˆë¡œìš´ ê²€ìƒ‰ì–´ ì²˜ë¦¬ ì‹œ) -->
    <div id="search-loading-overlay" class="position-fixed top-0 start-0 w-100 h-100 d-none" style="z-index: 2000; background: rgba(15, 23, 42, 0.95); backdrop-filter: blur(5px);">
        <div class="d-flex flex-column align-items-center justify-content-center h-100">
            <!-- ë©”ì¸ ë¡œë”© ìŠ¤í”¼ë„ˆ -->
            <div class="loading-spinner mb-4">
                <div class="spinner-ring">
                    <div></div>
                    <div></div>
                    <div></div>
                    <div></div>
                </div>
            </div>
            
            <!-- ë¡œë”© ë©”ì‹œì§€ -->
            <div class="text-center">
                <h4 id="loading-title" class="text-white mb-3">ìƒˆë¡œìš´ ì˜í™” ëŒ€ì‚¬ë¥¼ ì°¾ê³  ìˆìŠµë‹ˆë‹¤...</h4>
                <p id="loading-message" class="text-light opacity-75 mb-4">ì™¸ë¶€ APIì—ì„œ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤</p>
                
                <!-- ì§„í–‰ ë‹¨ê³„ í‘œì‹œ -->
                <div class="loading-steps">
                    <div class="step" id="step-search">
                        <i class="fas fa-search step-icon"></i>
                        <span class="step-text">ê²€ìƒ‰ ì¤‘...</span>
                    </div>
                    <div class="step" id="step-fetch">
                        <i class="fas fa-cloud-download-alt step-icon"></i>
                        <span class="step-text">ë°ì´í„° ê°€ì ¸ì˜¤ëŠ” ì¤‘...</span>
                    </div>
                    <div class="step" id="step-process">
                        <i class="fas fa-cogs step-icon"></i>
                        <span class="step-text">ë°ì´í„° ì²˜ë¦¬ ì¤‘...</span>
                    </div>
                    <div class="step" id="step-save">
                        <i class="fas fa-save step-icon"></i>
                        <span class="step-text">ì €ì¥ ì¤‘...</span>
                    </div>
                </div>
                
                <!-- í”„ë¡œê·¸ë ˆìŠ¤ ë°” -->
                <div class="progress mt-4" style="height: 6px; width: 300px; margin: 0 auto;">
                    <div id="search-progress" class="progress-bar bg-primary progress-bar-striped progress-bar-animated" 
                         role="progressbar" style="width: 0%" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">
                    </div>
                </div>
                
                <!-- ì˜ˆìƒ ì‹œê°„ -->
                <small class="text-muted mt-3 d-block">ì˜ˆìƒ ì†Œìš” ì‹œê°„: 5-10ì´ˆ</small>
            </div>
        </div>
    </div>

    <!-- ë©”ì¸ ì»¨í…Œì´ë„ˆ -->
    <div class="container py-4">
        <!-- í—¤ë” ì„¹ì…˜ -->
        <header class="text-center mb-5">
            <div class="d-flex align-items-center justify-content-center gap-4 mb-4">
                <!-- í”„ë¡œí•„ ì´ë¯¸ì§€ -->
                <img
                    src="{% static 'img/cskang.jpg' %}"
                    alt="Profile"
                    class="profile-image rounded-circle border border-3 border-light shadow-lg"
                    onclick="location.href='{% url 'phrase:index' %}'"
                    onerror="this.outerHTML='<div class=\'profile-image rounded-circle bg-primary d-flex align-items-center justify-content-center\' style=\'font-size: 2rem;\'>ğŸ¬</div>'"
                />
                
                <!-- ì œëª© ë° ì„¤ëª… -->
                <div class="d-flex flex-column text-start">
                    <h1 class="display-3 fw-bold text-gradient mb-2">í”Œë ˆì´í”„ë ˆì´ì¦ˆ</h1>
                    <p class="lead text-light opacity-75 mb-0">ì˜í™” ì† ì‹¤ì œ ëŒ€ì‚¬ë¥¼ ê²€ìƒ‰í•˜ê³  í´ë¦½ìœ¼ë¡œ ê°ìƒí•˜ì„¸ìš”</p>
                </div>
            </div>
        </header>

        <!-- ì„¤ëª… ì„¹ì…˜ -->
        <section class="mb-4">
            <div class="d-flex flex-column flex-sm-row gap-3 align-items-center">
                <div class="flex-fill bg-dark bg-opacity-50 border border-secondary rounded p-3 text-center">
                    <p class="mb-0 text-light opacity-75">
                        Django ê¸°ë°˜ ì˜í™” ëŒ€ì‚¬ ê²€ìƒ‰ ì„œë¹„ìŠ¤ - <strong>{{ total_results|default:0 }}ê°œ ê²€ìƒ‰ ê²°ê³¼</strong>
                        {% if from_cache %} (ìºì‹œë¨){% endif %}
                    </p>
                </div>
                <div class="flex-shrink-0 d-flex gap-2">
                    <!-- ê¸°ë³¸ ë§í¬ë“¤ -->
                    <a href="{% url 'phrase:korean_translation_status' %}" class="btn btn-outline-info btn-sm">
                        <i class="fas fa-language"></i> ë²ˆì—­ ìƒíƒœ
                    </a>
                    <a href="{% url 'phrase:debug_view' %}" class="btn btn-outline-success btn-sm">
                        <i class="fas fa-bug"></i> ë””ë²„ê·¸
                    </a>
                </div>
            </div>
        </section>

        <!-- ê²€ìƒ‰ í¼ ì„¹ì…˜: ë°˜ì‘í˜• ìµœì í™” ë²„ì „ (name ì†ì„± ì¶©ëŒ í•´ê²°) -->
        <section class="search-section mb-5">
            <form id="search-form" method="POST" action="{% url 'phrase:process_text' %}">
                {% csrf_token %}
                
                <!-- ìˆ¨ê²¨ì§„ í†µí•© ì…ë ¥ í•„ë“œ (ì‹¤ì œ ì„œë²„ë¡œ ì „ì†¡) -->
                <input type="hidden" id="unified-search-input" name="user_text" value="{{ message|default:'' }}">
                
                <!-- ë°ìŠ¤í¬í†±ìš© ê²€ìƒ‰ë°” (md ì´ìƒ) -->
                <div class="d-none d-md-block">
                    <div class="input-group input-group-lg">
                        <span class="input-group-text bg-dark border-secondary px-3">
                            <i class="fas fa-search text-primary"></i>
                        </span>
                        <input 
                            type="text" 
                            id="search-input-desktop"
                            class="form-control bg-dark border-secondary text-white"
                            placeholder="í•œê¸€ ë˜ëŠ” ì˜ì–´ êµ¬ë¬¸ì„ ì…ë ¥í•˜ì„¸ìš”... (ìµœëŒ€ 500ì)"
                            value="{{ message|default:'' }}"
                            autocomplete="off"
                            autofocus
                            maxlength="500"
                            aria-label="ê²€ìƒ‰ì–´ ì…ë ¥"
                        />
                        <button type="button" id="clear-search-desktop" class="btn btn-outline-secondary {% if not message %}d-none{% endif %}">
                            <i class="fas fa-times"></i>
                        </button>
                        <button 
                            type="submit" 
                            class="btn btn-primary px-4"
                            aria-label="ê²€ìƒ‰ ì‹¤í–‰"
                        >
                            <i class="fas fa-search me-2"></i>ê²€ìƒ‰
                        </button>
                    </div>
                </div>
                
                <!-- ëª¨ë°”ì¼/íƒœë¸”ë¦¿ìš© ê²€ìƒ‰ë°” (sm ì´í•˜) -->
                <div class="d-md-none">
                    <!-- ê²€ìƒ‰ ì…ë ¥ì°½ -->
                    <div class="position-relative mb-2">
                        <input 
                            type="text" 
                            id="search-input-mobile"
                            class="form-control form-control-lg bg-dark border-secondary text-white ps-5 pe-5"
                            placeholder="ê²€ìƒ‰ì–´ ì…ë ¥... (ìµœëŒ€ 500ì)"
                            value="{{ message|default:'' }}"
                            autocomplete="off"
                            maxlength="500"
                            aria-label="ê²€ìƒ‰ì–´ ì…ë ¥"
                            style="padding-right: 4rem !important;"
                        />
                        <!-- ì™¼ìª½ ë‹ë³´ê¸° ì•„ì´ì½˜ -->
                        <div class="position-absolute top-50 start-0 translate-middle-y ps-3" style="pointer-events: none;">
                            <i class="fas fa-search text-primary"></i>
                        </div>
                        <!-- ì˜¤ë¥¸ìª½ ì§€ìš°ê¸° ë²„íŠ¼ -->
                        <button 
                            type="button" 
                            id="clear-search-mobile" 
                            class="btn btn-link position-absolute top-50 end-0 translate-middle-y pe-3 text-secondary {% if not message %}d-none{% endif %}"
                            style="border: none; background: none; z-index: 10;"
                            aria-label="ê²€ìƒ‰ì–´ ì§€ìš°ê¸°"
                        >
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    
                    <!-- ê²€ìƒ‰ ë²„íŠ¼ -->
                    <div class="d-grid">
                        <button 
                            type="submit" 
                            class="btn btn-primary btn-lg"
                            aria-label="ê²€ìƒ‰ ì‹¤í–‰"
                        >
                            <i class="fas fa-search me-2"></i>ê²€ìƒ‰í•˜ê¸°
                        </button>
                    </div>
                </div>
                
                <!-- ê²€ìƒ‰ ì˜µì…˜ (ëª¨ë“  í™”ë©´ í¬ê¸°ì—ì„œ ë™ì¼) -->
                <div class="row mt-3 g-2">
                    <div class="col-sm-6">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="include-korean" checked>
                            <label class="form-check-label text-light small" for="include-korean">
                                <i class="fas fa-language me-1"></i>í•œê¸€ ë²ˆì—­ í¬í•¨ ê²€ìƒ‰
                            </label>
                        </div>
                    </div>
                    <div class="col-sm-6">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="exact-match">
                            <label class="form-check-label text-light small" for="exact-match">
                                <i class="fas fa-bullseye me-1"></i>ì •í™•í•œ ë¬¸êµ¬ë§Œ ê²€ìƒ‰
                            </label>
                        </div>
                    </div>
                </div>
                
                <!-- ì¶”ê°€ ê²€ìƒ‰ ì˜µì…˜ (ì ‘ì„ ìˆ˜ ìˆëŠ” í˜•íƒœ) -->
                <div class="mt-2">
                    <button 
                        class="btn btn-link btn-sm text-muted p-0" 
                        type="button" 
                        data-bs-toggle="collapse" 
                        data-bs-target="#advanced-options" 
                        aria-expanded="false" 
                        aria-controls="advanced-options"
                    >
                        <i class="fas fa-cog me-1"></i>ê³ ê¸‰ ì˜µì…˜
                        <i class="fas fa-chevron-down ms-1"></i>
                    </button>
                    
                    <div class="collapse mt-2" id="advanced-options">
                        <div class="card bg-dark border-secondary">
                            <div class="card-body py-2">
                                <div class="row g-2">
                                    <div class="col-md-4 col-sm-6">
                                        <div class="form-check form-check-sm">
                                            <input class="form-check-input" type="checkbox" id="include-subtitles">
                                            <label class="form-check-label text-light small" for="include-subtitles">
                                                ìë§‰ ê²€ìƒ‰ í¬í•¨
                                            </label>
                                        </div>
                                    </div>
                                    <div class="col-md-4 col-sm-6">
                                        <div class="form-check form-check-sm">
                                            <input class="form-check-input" type="checkbox" id="case-sensitive">
                                            <label class="form-check-label text-light small" for="case-sensitive">
                                                ëŒ€ì†Œë¬¸ì êµ¬ë¶„
                                            </label>
                                        </div>
                                    </div>
                                    <div class="col-md-4 col-sm-12">
                                        <select class="form-select form-select-sm bg-dark border-secondary text-white">
                                            <option value="all">ëª¨ë“  ì—°ë„</option>
                                            <option value="2020s">2020ë…„ëŒ€</option>
                                            <option value="2010s">2010ë…„ëŒ€</option>
                                            <option value="2000s">2000ë…„ëŒ€</option>
                                            <option value="classic">ê·¸ ì´ì „</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </form>
            
            <!-- ê²€ìƒ‰ ì œì•ˆ (ëª¨ë“  í™”ë©´ í¬ê¸°ì—ì„œ ë™ì¼) -->
            <div id="search-suggestions" class="mt-3 d-none">
                <div class="bg-dark border border-secondary rounded p-3">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <h6 class="text-primary mb-0">
                            <i class="fas fa-lightbulb me-1"></i>ì¶”ì²œ ê²€ìƒ‰ì–´
                        </h6>
                        <button id="close-suggestions" class="btn btn-sm btn-outline-secondary">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div id="suggestions-list" class="d-flex flex-wrap gap-2">
                        <!-- ë™ì ìœ¼ë¡œ ì±„ì›Œì§ -->
                    </div>
                </div>
            </div>
            
            <!-- ë¹ ë¥¸ ê²€ìƒ‰ ë²„íŠ¼ë“¤ (ëª¨ë°”ì¼ì—ì„œë§Œ í‘œì‹œ) -->
            <div class="d-md-none mt-3">
                <div class="d-flex justify-content-between align-items-center mb-2">
                    <small class="text-muted">
                        <i class="fas fa-bolt me-1"></i>ë¹ ë¥¸ ê²€ìƒ‰
                    </small>
                    <button class="btn btn-link btn-sm text-muted p-0" id="refresh-quick-search">
                        <i class="fas fa-refresh"></i>
                    </button>
                </div>
                <div class="d-flex flex-wrap gap-2" id="quick-search-buttons">
                    <button type="button" class="btn btn-outline-primary btn-sm quick-search-btn" data-query="hello">
                        "hello"
                    </button>
                    <button type="button" class="btn btn-outline-primary btn-sm quick-search-btn" data-query="thank you">
                        "thank you"
                    </button>
                    <button type="button" class="btn btn-outline-primary btn-sm quick-search-btn" data-query="i love you">
                        "i love you"
                    </button>
                    <button type="button" class="btn btn-outline-primary btn-sm quick-search-btn" data-query="good morning">
                        "good morning"
                    </button>
                </div>
            </div>
        </section>

        <!-- ì˜¤ë¥˜ í‘œì‹œ: views.py error ë³€ìˆ˜ í™œìš© -->
        {% if error %}
        <section class="mb-4">
            <div class="alert alert-danger" role="alert">
                <h6 class="alert-heading">
                    <i class="fas fa-exclamation-triangle me-2"></i>ê²€ìƒ‰ ê²°ê³¼ ì—†ìŒ
                </h6>
                <p class="mb-2">{{ error }}</p>
                <hr>
                <div class="d-flex gap-2">
                    <button class="btn btn-outline-danger btn-sm" onclick="document.getElementById('search-input-desktop') && document.getElementById('search-input-desktop').focus() || document.getElementById('search-input-mobile') && document.getElementById('search-input-mobile').focus()">
                        <i class="fas fa-redo me-1"></i>ë‹¤ì‹œ ê²€ìƒ‰
                    </button>
                    <button id="show-popular-on-error" class="btn btn-outline-primary btn-sm">
                        <i class="fas fa-fire me-1"></i>ì¸ê¸° ê²€ìƒ‰ì–´ ë³´ê¸°
                    </button>
                </div>
            </div>
        </section>
        {% endif %}

        <!-- ê²€ìƒ‰ ê²°ê³¼ ì •ë³´: views.py ë³€ìˆ˜ë“¤ í™œìš© -->
        {% if message %}
        <section class="search-result-info mb-4">
            <div class="bg-dark bg-opacity-50 border border-secondary rounded p-4">
                <div class="row align-items-center">
                    <div class="col-md-8">
                        <h5 class="text-primary mb-2">
                            <i class="fas fa-search me-2"></i>ê²€ìƒ‰ ê²°ê³¼
                        </h5>
                        <div class="d-flex flex-wrap gap-3 align-items-center">
                            <span class="badge bg-primary fs-6">"{{ message }}"</span>
                            {% if translated_message %}
                            <i class="fas fa-arrow-right text-muted"></i>
                            <span class="badge bg-success fs-6">"{{ translated_message }}"</span>
                            {% endif %}
                        </div>
                    </div>
                    <div class="col-md-4 text-md-end mt-2 mt-md-0">
                        <div class="text-muted small">
                            {% if total_results %}
                            <i class="fas fa-list me-1"></i>{{ total_results }}ê°œ ê²°ê³¼
                            {% endif %}
                            {% if from_cache %}
                            <br><i class="fas fa-bolt me-1"></i>ìºì‹œì—ì„œ ë¡œë“œ
                            {% elif source == 'database' %}
                            <br><i class="fas fa-database me-1"></i>DBì—ì„œ ë¡œë“œ
                            {% else %}
                            <br><i class="fas fa-cloud me-1"></i>APIì—ì„œ ë¡œë“œ
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </section>
        {% endif %}

        <!-- ì˜í™” ì¹´ë“œ ì„¹ì…˜: models.py MovieTable, DialogueTable êµ¬ì¡° ë°˜ì˜ -->
        {% if movies %}
        <section class="movies-section">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2 class="h4 mb-0">
                    <i class="fas fa-film me-2"></i>ê²€ìƒ‰ ê²°ê³¼
                    <span class="badge bg-secondary ms-2">{{ movies|length }}</span>
                </h2>
                
                <!-- ì •ë ¬ ì˜µì…˜ -->
                <div class="d-flex gap-2">
                    <select id="sort-select" class="form-select form-select-sm bg-dark border-secondary text-white" style="width: auto;">
                        <option value="relevance">ê´€ë ¨ì„± ìˆœ</option>
                        <option value="movie_title">ì˜í™”ëª… ìˆœ</option>
                        <option value="release_year">ê°œë´‰ë…„ë„ ìˆœ</option>
                        <option value="view_count">ì¡°íšŒìˆ˜ ìˆœ</option>
                    </select>
                    <button id="download-results" class="btn btn-outline-info btn-sm">
                        <i class="fas fa-download"></i>
                    </button>
                </div>
            </div>
            
            <div class="row g-4" id="movies-container">
                {% for movie in movies %}
                <div class="col-lg-3 col-md-4 col-sm-6" data-movie-data='{{ movie|safe }}'>
                    <div class="movie-card card bg-dark border-secondary h-100" data-movie-index="{{ forloop.counter0 }}">
                        <!-- í¬ìŠ¤í„° ì´ë¯¸ì§€: models.py MovieTable.poster_url, poster_image í™œìš© -->
                        <div class="movie-card-image position-relative overflow-hidden" 
                             style="cursor: pointer; height: 300px;"
                             data-bs-toggle="modal" 
                             data-bs-target="#video-modal"
                             onclick="openVideoModal(
                                 '{{ movie.dialogues.0.video_url|default:'' }}',
                                 '{{ movie.title|default:movie.movie_title|escapejs }}',
                                 '{{ movie.year|default:movie.release_year }}',
                                 '{{ movie.country|default:movie.production_country }}',
                                 '{{ movie.dialogues.0.text|default:movie.dialogues.0.dialogue_phrase|escapejs }}',
                                 '{{ movie.dialogues.0.text_ko|default:movie.dialogues.0.dialogue_phrase_ko|escapejs }}'
                             )">
                            
                            {% if movie.poster_url %}
                                <img 
                                    src="{{ movie.poster_url }}"
                                    alt="{{ movie.title|default:movie.movie_title }} í¬ìŠ¤í„°"
                                    class="card-img-top h-100 object-fit-cover"
                                    style="opacity: 0; transition: opacity 0.3s ease;"
                                    onload="this.style.opacity='1'; this.parentElement.classList.remove('loading');"
                                    onerror="handlePosterError(this)"
                                />
                            {% elif movie.poster_image_path %}
                                <img 
                                    src="{{ movie.poster_image_path }}"
                                    alt="{{ movie.title|default:movie.movie_title }} í¬ìŠ¤í„°"
                                    class="card-img-top h-100 object-fit-cover"
                                    style="opacity: 0; transition: opacity 0.3s ease;"
                                    onload="this.style.opacity='1'; this.parentElement.classList.remove('loading');"
                                    onerror="handlePosterError(this)"
                                />
                            {% else %}
                                <div class="poster-placeholder d-flex flex-column align-items-center justify-content-center h-100 bg-secondary bg-opacity-50">
                                    <i class="fas fa-film text-muted" style="font-size: 3rem;"></i>
                                    <span class="text-muted mt-2">í¬ìŠ¤í„° ì—†ìŒ</span>
                                </div>
                            {% endif %}
                            
                            <!-- í˜¸ë²„ ì˜¤ë²„ë ˆì´ -->
                            <div class="poster-overlay position-absolute top-0 start-0 w-100 h-100 d-flex align-items-center justify-content-center" 
                                 style="background: rgba(0, 0, 0, 0.6); opacity: 0; transition: opacity 0.3s ease;">
                                <div class="play-icon bg-primary rounded-circle d-flex align-items-center justify-content-center" 
                                     style="width: 80px; height: 80px; transition: transform 0.3s ease;">
                                    <i class="fas fa-play text-white" style="font-size: 1.5rem; margin-left: 4px;"></i>
                                </div>
                            </div>
                        </div>
                        
                        <!-- ì¹´ë“œ ë³¸ë¬¸: models.py í•„ë“œë“¤ í™œìš© -->
                        <div class="card-body d-flex flex-column">
                            <!-- ì˜í™” ì •ë³´: MovieTable í•„ë“œë“¤ -->
                            <div class="movie-info mb-3">
                                <h5 class="card-title text-primary mb-2">
                                    {{ movie.title|default:movie.movie_title }}
                                </h5>
                                <div class="movie-meta d-flex flex-wrap gap-2 mb-2">
                                    {% if movie.year|default:movie.release_year %}
                                    <span class="badge bg-outline-secondary">{{ movie.year|default:movie.release_year }}</span>
                                    {% endif %}
                                    {% if movie.director %}
                                    <span class="badge bg-outline-secondary">{{ movie.director }}</span>
                                    {% endif %}
                                    {% if movie.genre %}
                                    <span class="badge bg-outline-secondary">{{ movie.genre }}</span>
                                    {% endif %}
                                </div>
                                
                                <!-- ì˜í™” í†µê³„: MovieTable.view_count ë“± -->
                                {% if movie.view_count or movie.imdb_rating %}
                                <div class="movie-stats small text-muted">
                                    {% if movie.view_count %}
                                    <i class="fas fa-eye me-1"></i>{{ movie.view_count }}íšŒ ì¡°íšŒ
                                    {% endif %}
                                    {% if movie.imdb_rating %}
                                    <span class="ms-2"><i class="fas fa-star me-1"></i>{{ movie.imdb_rating }}</span>
                                    {% endif %}
                                </div>
                                {% endif %}
                            </div>
                            
                            <!-- ëŒ€ì‚¬ ì •ë³´: DialogueTable í•„ë“œë“¤ -->
                            {% if movie.dialogues %}
                            {% with dialogue=movie.dialogues.0 %}
                            <div class="dialogue-section mt-auto">
                                <!-- ì˜ì–´ ëŒ€ì‚¬: DialogueTable.dialogue_phrase -->
                                <div class="mb-3">
                                    <h6 class="text-light mb-2">
                                        <i class="fas fa-quote-left me-1"></i>ì˜ì–´ ëŒ€ì‚¬
                                    </h6>
                                    <p class="card-text text-light small">
                                        "{{ dialogue.text|default:dialogue.dialogue_phrase }}"
                                    </p>
                                </div>
                                
                                <!-- í•œê¸€ ë²ˆì—­: DialogueTable.dialogue_phrase_ko -->
                                <div>
                                    <h6 class="text-success mb-2">
                                        <i class="fas fa-language me-1"></i>í•œê¸€ ë²ˆì—­
                                    </h6>
                                    {% if dialogue.text_ko|default:dialogue.dialogue_phrase_ko %}
                                    <p class="card-text text-success small db-translated">
                                        ğŸ’¾ "{{ dialogue.text_ko|default:dialogue.dialogue_phrase_ko }}"
                                    </p>
                                    {% else %}
                                    <p class="card-text text-warning small">
                                        <i class="fas fa-language me-1"></i>ë²ˆì—­ í•„ìš”
                                        <button class="btn btn-outline-warning btn-sm ms-2 translate-btn" 
                                                data-text="{{ dialogue.text|default:dialogue.dialogue_phrase|escapejs }}">
                                            ë²ˆì—­í•˜ê¸°
                                        </button>
                                    </p>
                                    {% endif %}
                                </div>
                                
                                <!-- ëŒ€ì‚¬ ë©”íƒ€ë°ì´í„° -->
                                <div class="dialogue-meta mt-2 pt-2 border-top border-secondary">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <small class="text-muted">
                                            {% if dialogue.start_time|default:dialogue.dialogue_start_time %}
                                            <i class="fas fa-clock me-1"></i>{{ dialogue.start_time|default:dialogue.dialogue_start_time }}
                                            {% endif %}
                                        </small>
                                        <div class="dialogue-actions">
                                            <button class="btn btn-outline-primary btn-sm copy-dialogue" 
                                                    title="ë³µì‚¬" 
                                                    data-text="{{ dialogue.text|default:dialogue.dialogue_phrase }}">
                                                <i class="fas fa-copy"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            {% endwith %}
                            {% endif %}
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
            
            <!-- ë” ë§ì€ ê²°ê³¼ ë²„íŠ¼ -->
            {% if has_more_results %}
            <div class="text-center mt-5">
                <button id="load-more" class="btn btn-outline-primary btn-lg">
                    <i class="fas fa-plus me-2"></i>ë” ë§ì€ ê²°ê³¼ ë³´ê¸° ({{ total_results|add:"-5" }}ê°œ ë”)
                </button>
            </div>
            {% endif %}
        </section>
        {% endif %}

        <!-- ì¸ê¸° ê²€ìƒ‰ì–´ ì„¹ì…˜ (ë™ì  ë¡œë“œ) -->
        <section id="popular-section" class="mt-5 d-none">
            <h3 class="h5 mb-3">
                <i class="fas fa-fire text-warning me-2"></i>ì¸ê¸° ê²€ìƒ‰ì–´
            </h3>
            <div id="popular-searches-container" class="row g-3">
                <div class="col-12 text-center">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">ë¡œë”© ì¤‘...</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- í†µê³„ ì„¹ì…˜ (ë™ì  ë¡œë“œ) -->
        <section id="statistics-section" class="mt-5 d-none">
            <h3 class="h5 mb-3">
                <i class="fas fa-chart-bar text-success me-2"></i>ì„œë¹„ìŠ¤ í†µê³„
            </h3>
            <div id="statistics-container" class="row g-3">
                <div class="col-md-3 col-sm-6">
                    <div class="bg-dark border border-secondary rounded p-3 text-center">
                        <div class="display-6 text-primary" id="total-movies">-</div>
                        <div class="small text-muted">ë“±ë¡ëœ ì˜í™”</div>
                    </div>
                </div>
                <div class="col-md-3 col-sm-6">
                    <div class="bg-dark border border-secondary rounded p-3 text-center">
                        <div class="display-6 text-success" id="total-dialogues">-</div>
                        <div class="small text-muted">ì˜í™” ëŒ€ì‚¬</div>
                    </div>
                </div>
                <div class="col-md-3 col-sm-6">
                    <div class="bg-dark border border-secondary rounded p-3 text-center">
                        <div class="display-6 text-info" id="total-searches">-</div>
                        <div class="small text-muted">ì´ ê²€ìƒ‰ ìˆ˜</div>
                    </div>
                </div>
                <div class="col-md-3 col-sm-6">
                    <div class="bg-dark border border-secondary rounded p-3 text-center">
                        <div class="display-6 text-warning" id="translation-rate">-</div>
                        <div class="small text-muted">ë²ˆì—­ ì™„ë£Œìœ¨</div>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <!-- ë¹„ë””ì˜¤ ëª¨ë‹¬ -->
    <div class="modal fade" id="video-modal" tabindex="-1" aria-labelledby="video-modal-label" aria-hidden="true">
        <div class="modal-dialog modal-xl modal-dialog-centered">
            <div class="modal-content bg-dark border-secondary">
                <div class="modal-header border-secondary">
                    <h5 class="modal-title text-primary" id="modal-title">ì˜í™” ì œëª©</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body p-0">
                    <!-- ë¹„ë””ì˜¤ ë¡œë”© -->
                    <div id="video-loading" class="d-flex flex-column align-items-center justify-content-center py-5">
                        <div class="spinner-border text-primary mb-3" role="status">
                            <span class="visually-hidden">ë¹„ë””ì˜¤ ë¡œë”© ì¤‘...</span>
                        </div>
                        <p class="text-light">ë¹„ë””ì˜¤ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
                    </div>
                    
                    <!-- ë¹„ë””ì˜¤ í”Œë ˆì´ì–´ -->
                    <video id="modal-video" class="w-100 d-none" controls preload="metadata" loop autoplay muted>
                        <source id="video-source" src="" type="video/mp4">
                        <source id="video-source-webm" src="" type="video/webm">
                        <source id="video-source-ogg" src="" type="video/ogg">
                        ë¸Œë¼ìš°ì €ê°€ ë¹„ë””ì˜¤ë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
                    </video>
                    
                    <!-- ë¹„ë””ì˜¤ ì˜¤ë¥˜ -->
                    <div id="video-error" class="d-none">
                        <div class="error-content text-center py-5">
                            <i class="fas fa-exclamation-triangle text-danger mb-3" style="font-size: 3rem;"></i>
                            <h4 class="text-danger mb-3">ë¹„ë””ì˜¤ ì¬ìƒ ì˜¤ë¥˜</h4>
                            <p id="error-message" class="text-light mb-3">ì˜¤ë¥˜ ë©”ì‹œì§€</p>
                            <div class="error-details mb-4">
                                <p class="text-muted mb-1">ë¹„ë””ì˜¤ URL:</p>
                                <code id="error-url" class="text-warning">URL í‘œì‹œ</code>
                            </div>
                            <button onclick="retryVideo()" class="btn btn-primary">
                                <i class="fas fa-redo me-2"></i>ë‹¤ì‹œ ì‹œë„
                            </button>
                        </div>
                    </div>
                </div>
                <div class="modal-footer border-secondary">
                    <!-- ì˜ì–´ ëŒ€ì‚¬ -->
                    <div class="w-100 mb-3">
                        <h6 class="text-light mb-2">
                            <i class="fas fa-quote-left me-1"></i>ì˜ì–´ ëŒ€ì‚¬
                        </h6>
                        <p id="modal-text-en" class="text-light mb-0">ì˜ì–´ ëŒ€ì‚¬ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</p>
                    </div>
                    
                    <!-- í•œê¸€ ë²ˆì—­ -->
                    <div class="w-100">
                        <h6 class="text-success mb-2">
                            <i class="fas fa-language me-1"></i>í•œê¸€ ë²ˆì—­
                        </h6>
                        <p id="modal-text-ko" class="text-success mb-0">í•œê¸€ ë²ˆì—­ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- í† ìŠ¤íŠ¸ ì»¨í…Œì´ë„ˆ -->
    <div id="toast-container" class="position-fixed top-0 end-0 p-3" style="z-index: 1100;">
        <!-- ë™ì ìœ¼ë¡œ í† ìŠ¤íŠ¸ ì¶”ê°€ë¨ -->
    </div>

    <!-- Bootstrap 5 JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Django í…œí”Œë¦¿ ë°ì´í„° ì „ë‹¬ -->
    <script>
        // ì‹¤ì œ Django views.pyì—ì„œ ì „ë‹¬ëœ ë°ì´í„°
        window.djangoData = {
            csrf_token: '{{ csrf_token }}',
            
            // URL íŒ¨í„´ (API ë¯¸êµ¬í˜„ ì‹œ ì„ì‹œ ì²˜ë¦¬)
            urls: {
                {% comment %}
                // APIê°€ êµ¬í˜„ë˜ë©´ ì•„ë˜ ì£¼ì„ì„ í•´ì œí•˜ì„¸ìš”:
                popular_searches: '{% url "phrase:popular_searches_api" %}',
                statistics: '{% url "phrase:statistics_api" %}',
                bulk_translate: '{% url "phrase:bulk_translate_dialogues" %}'
                 {% endcomment %}
                popular_searches: '/api/search/',  // ì„ì‹œë¡œ ê¸°ì¡´ API ì‚¬ìš©
                statistics: '/api/schema/',  // ì„ì‹œë¡œ ê¸°ì¡´ API ì‚¬ìš©  
                bulk_translate: ''  // ë¯¸êµ¬í˜„
            },
            
            // í˜„ì¬ ê²€ìƒ‰ ì •ë³´
            search: {
                query: "{{ message|escapejs }}",
                translated: "{{ translated_message|escapejs }}",
                phrase: "{{ search_used|escapejs }}",
                hasResults: {{ movies|yesno:"true,false" }},
                totalResults: {{ total_results|default:0 }},
                fromCache: {{ from_cache|yesno:"true,false" }},
                source: "{{ source|default:'database' }}"
            },
            
            // ì„¤ì •
            settings: {
                maxSearchLength: 500,  // RequestTable.request_phrase max_length
                minSearchLength: 2,
                debounceDelay: 300,
                cacheTimeout: 600000
            }
        };

        // ì „ì—­ í•¨ìˆ˜ë“¤ (HTMLì—ì„œ í˜¸ì¶œë¨)
        window.handlePosterError = function(img) {
            const container = img.parentElement;
            container.innerHTML = `
                <div class="poster-placeholder d-flex flex-column align-items-center justify-content-center h-100 bg-secondary bg-opacity-50">
                    <i class="fas fa-film text-muted" style="font-size: 3rem;"></i>
                    <span class="text-muted mt-2">í¬ìŠ¤í„° ì—†ìŒ</span>
                </div>
            `;
        };

        window.openVideoModal = function(videoUrl, title, year, country, textEn, textKo) {
            console.log('ğŸ¬ ë¹„ë””ì˜¤ ëª¨ë‹¬ ì—´ê¸°:', { videoUrl, title, year, country, textEn, textKo });
            
            // ëª¨ë‹¬ ì œëª© ì„¤ì •
            const modalTitle = document.getElementById('modal-title');
            if (modalTitle) {
                modalTitle.textContent = `${title} (${year}, ${country})`;
            }

            // ì˜ì–´ ëŒ€ì‚¬ ì„¤ì •
            const modalTextEn = document.getElementById('modal-text-en');
            if (modalTextEn) {
                modalTextEn.textContent = `"${textEn}"`;
            }

            // í•œê¸€ ë²ˆì—­ ì„¤ì •
            const modalTextKo = document.getElementById('modal-text-ko');
            if (modalTextKo) {
                if (textKo && textKo.trim()) {
                    modalTextKo.innerHTML = `ğŸ’¾ "${textKo}"`;
                } else {
                    modalTextKo.innerHTML = '<span class="text-muted">ë²ˆì—­ì´ í•„ìš”í•©ë‹ˆë‹¤.</span>';
                }
            }

            // ë¹„ë””ì˜¤ ì„¤ì • (ë¬´í•œ ë£¨í”„ ìë™ ì¬ìƒ)
            const videoLoading = document.getElementById('video-loading');
            const modalVideo = document.getElementById('modal-video');
            const videoError = document.getElementById('video-error');

            // ì´ˆê¸° ìƒíƒœ
            if (videoLoading) videoLoading.classList.remove('d-none');
            if (modalVideo) modalVideo.classList.add('d-none');
            if (videoError) videoError.classList.add('d-none');

            if (videoUrl && videoUrl.trim()) {
                const videoSource = document.getElementById('video-source');
                if (videoSource) {
                    videoSource.src = videoUrl;
                    
                    // ë¹„ë””ì˜¤ ì†ì„± ì„¤ì • (ë¬´í•œ ë£¨í”„ + ìë™ì¬ìƒ)
                    modalVideo.loop = true;
                    modalVideo.autoplay = true;
                    modalVideo.muted = true; // ìë™ì¬ìƒì„ ìœ„í•´ ìŒì†Œê±° (ë¸Œë¼ìš°ì € ì •ì±…)
                    
                    modalVideo.load();
                    
                    modalVideo.addEventListener('loadeddata', function() {
                        console.log('ğŸ“¹ ë¹„ë””ì˜¤ ë°ì´í„° ë¡œë“œ ì™„ë£Œ - ìë™ ì¬ìƒ ì‹œì‘');
                        videoLoading.classList.add('d-none');
                        modalVideo.classList.remove('d-none');
                        
                        // ìë™ ì¬ìƒ ì‹œë„
                        modalVideo.play().then(() => {
                            console.log('âœ… ë¹„ë””ì˜¤ ìë™ ì¬ìƒ ì„±ê³µ');
                            // ì‚¬ìš©ìê°€ í´ë¦­í•˜ë©´ ìŒì†Œê±° í•´ì œ
                            modalVideo.addEventListener('click', function() {
                                this.muted = false;
                                console.log('ğŸ”Š ìŒì†Œê±° í•´ì œ');
                            }, { once: true });
                        }).catch(error => {
                            console.warn('âš ï¸ ìë™ ì¬ìƒ ì‹¤íŒ¨:', error);
                        });
                    }, { once: true });
                    
                    modalVideo.addEventListener('error', function() {
                        videoLoading.classList.add('d-none');
                        videoError.classList.remove('d-none');
                        
                        const errorMessage = document.getElementById('error-message');
                        const errorUrl = document.getElementById('error-url');
                        if (errorMessage) errorMessage.textContent = 'ë¹„ë””ì˜¤ë¥¼ ë¡œë“œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.';
                        if (errorUrl) errorUrl.textContent = videoUrl;
                    }, { once: true });
                }
            } else {
                videoLoading.classList.add('d-none');
                videoError.classList.remove('d-none');
                
                const errorMessage = document.getElementById('error-message');
                const errorUrl = document.getElementById('error-url');
                if (errorMessage) errorMessage.textContent = 'ë¹„ë””ì˜¤ URLì´ ì—†ìŠµë‹ˆë‹¤.';
                if (errorUrl) errorUrl.textContent = 'ì•Œ ìˆ˜ ì—†ìŒ';
            }
        };

        window.retryVideo = function() {
            console.log('ğŸ”„ ë¹„ë””ì˜¤ ì¬ì‹œë„');
            const modalVideo = document.getElementById('modal-video');
            if (modalVideo) {
                modalVideo.load();
            }
        };
    </script>
    
    <!-- ì‚¬ìš©ì ì •ì˜ JavaScript -->
    <script src="{% static 'js/index.js' %}"></script>
    {% include 'partials/scripts_optimized.html' %}
</body>
</html>